@implements IDisposable

@code {
    [CascadingParameter]
    public IProductService<BlazorDishModel>? ProductService { get; set; }

    private bool previousEnabled => ProductService?.CurrentPage > 1;
    private bool nextEnabled => ProductService?.CurrentPage < ProductService?.TotalPages;

    private bool IsActive(int pageNo) => pageNo == ProductService?.CurrentPage;

    protected override void OnInitialized()
    {
        if (ProductService != null)
        {
            ProductService.ListChanged += StateHasChanged;
        }
    }

    private async Task OnPageSelected(int pageNo)
    {
        if (ProductService != null && pageNo >= 1 && pageNo <= ProductService.TotalPages)
        {
            await ProductService.GetProducts(pageNo);
        }
    }

    public void Dispose()
    {
        if (ProductService != null)
        {
            ProductService.ListChanged -= StateHasChanged;
        }
    }
}

@if (ProductService != null && ProductService.TotalPages > 1)
{
    <nav>
        <ul class="pagination">
            <li class="page-item @(previousEnabled ? "" : "disabled")">
                <a class="page-link" href="#" @onclick="() => OnPageSelected(ProductService.CurrentPage - 1)" @onclick:preventDefault>
                    Назад
                </a>
            </li>

            @for (int i = 1; i <= ProductService.TotalPages; i++)
            {
                var pageNumber = i;
                <li class="page-item @(IsActive(pageNumber) ? "active" : "")">
                    <a class="page-link" href="#" @onclick="() => OnPageSelected(pageNumber)" @onclick:preventDefault>
                        @pageNumber
                    </a>
                </li>
            }

            <li class="page-item @(nextEnabled ? "" : "disabled")">
                <a class="page-link" href="#" @onclick="() => OnPageSelected(ProductService.CurrentPage + 1)" @onclick:preventDefault>
                    Вперед
                </a>
            </li>
        </ul>
    </nav>
}