@model Labs.Domain.Models.ListModel<Labs.Domain.Entities.Dish>

@{
    ViewData["Title"] = "Каталог блюд";
    var request = ViewContext.HttpContext.Request;
    var categories = ViewData["Categories"] as IEnumerable<Labs.Domain.Entities.Category>;

    // Получаем категорию из маршрута
    string? category = ViewContext.RouteData.Values["category"]?.ToString();
}

<h2 class="m-3">Блюда дня</h2>

<div class="row mb-4">
    <!-- Выбор категории -->
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Категории</h5>
            </div>
            <div class="card-body">
                <div class="list-group">
                    <a class="list-group-item list-group-item-action @(string.IsNullOrEmpty(category) ? "active" : "")"
                       asp-controller="Product"
                       asp-action="Index"
                       asp-route-category="@null">
                        Все
                    </a>
                    @if (categories != null)
                    {
                        @foreach (var item in categories)
                        {
                            <a class="list-group-item list-group-item-action @(category == item.NormalizedName ? "active" : "")"
                               asp-controller="Product"
                               asp-action="Index"
                               asp-route-category="@item.NormalizedName">
                                @item.Name
                            </a>
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Список блюд -->
    <div class="col-md-9">
        <div class="row">
            @if (Model.Items != null && Model.Items.Any())
            {
                @foreach (var item in Model.Items)
                {
                    <partial name="_ProductItemPartial" model="@item" />
                }
            }
            else
            {
                <div class="col-12">
                    <div class="alert alert-warning" role="alert">
                        @ViewData["Error"] ?? "Нет блюд в выбранной категории"
                    </div>
                </div>
            }
        </div>

        <!-- Пагинация -->
        @if (Model.TotalPages > 1)
        {
            <div class="row mt-4">
                <div class="col-12">
                    <pager current-page="@Model.CurrentPage"
                           total-pages="@Model.TotalPages"
                           category="@category"
                           controller="Product"
                           action="Index"></pager>
                </div>
            </div>
        }
    </div>
</div>